# Chapter 6. ORM 사용해보기 (1)

<aside>
<img src="https://www.notion.so/icons/list_gray.svg" alt="https://www.notion.so/icons/list_gray.svg" width="40px" /> **목차**

</aside>

## 📝 학습 목표

1. ORM의 개념과 사용 방법 이해하기

## 📸 잠깐! 스터디 인증샷은 찍으셨나요?

<aside>
💡 스터디장께서는 대표로 매 주차 스터디 인증샷을 남겨주세요!
사진을 저장하여 이미지 업로드할 수도 있고, 복사 & 붙여넣기를 통해 업로드할 수도 있습니다.

</aside>

[](https://www.notion.so)

## 📑 6주차 주제

Express 프로젝트에서 SQL을 직접 사용하던 부분을 ORM을 이용하도록 변경 및 리팩토링할 예정입니다.

## 🔖 6주차 본문

지난 주에 함께 개발했던 Repository, 그리고 미션에서 직접 개발했던 Repository들이 기억나시나요?

```jsx
export const getUserPreferencesByUserId = async (userId) => {
  const conn = await pool.getConnection();

  try {
    const [preferences] = await pool.query(
      "SELECT ufc.uf_category_id, ufc.f_category_id, ufc.user_id, fcl.f_category_name " +
        "FROM user_favor_category ufc JOIN food_category_list fcl on ufc.f_category_id = fcl.f_category_id " +
        "WHERE ufc.user_id = ? ORDER BY ufc.f_category_id ASC;",
      userId
    );

    return preferences;
  } catch (err) {
    throw new Error(
      `오류가 발생했어요. 요청 파라미터를 확인해주세요. (${err})`
    );
  } finally {
    conn.release();
  }
};
```

다시 봐도 그렇게 읽기 쉬운 코드는 아닌 것 같습니다 🥲 SQL 문을 조금이라도 잘못 작성하면 실패하게 되어 원인을 찾기 어려워지고, 쿼리가 길어질수록 수정하기 무서울 것 같지 않나요?

### 🔨 ORM 사용해보기

<aside>
💡 ORM에 대해 알아보고 사용해볼게요!

</aside>

[Chapter 6. ORM 사용해보기 - ORM 사용해보기](Chapter%206%20ORM%20%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0%20(1)/Chapter%206%20ORM%20%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0%20-%20ORM%20%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0%2029db57f4596b812b84b0da262ce86214.md)

### 🍍 DB 마이그레이션 파일 관리해보기

<aside>
💡

ORM을 이용해서 DB 마이그레이션 파일을 관리해보도록 하겠습니다.

</aside>

[Chapter 6. ORM 사용해보기 - DB 마이그레이션 파일 관리해보기](Chapter%206%20ORM%20%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0%20(1)/Chapter%206%20ORM%20%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0%20-%20DB%20%EB%A7%88%EC%9D%B4%EA%B7%B8%EB%A0%88%EC%9D%B4%EC%85%98%20%ED%8C%8C%EC%9D%BC%20%EA%B4%80%EB%A6%AC%ED%95%B4%EB%B3%B4%EA%B8%B0%2029db57f4596b817dbd8ee6127f2b0a22.md)

### 📜 목록 API 만들어보기

<aside>
💡

리뷰 목록 조회를 토대로 어떻게 목록 API를 만들어볼지, 함께 방법을 찾아봅니다.

</aside>

[Chapter 6. ORM 사용해보기 - 목록 API 만들어보기](Chapter%206%20ORM%20%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0%20(1)/Chapter%206%20ORM%20%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0%20-%20%EB%AA%A9%EB%A1%9D%20API%20%EB%A7%8C%EB%93%A4%EC%96%B4%EB%B3%B4%EA%B8%B0%2029db57f4596b81d283b6ef06e6eb63c8.md)

## 🎯 핵심 키워드

<aside>
💡 주요 내용들을 정리하고, 여러분만의 생각을 통해 정리해보세요!

- 레퍼런스를 참고하여 정의, 속성, 장단점 등을 적어주셔도 괜찮습니다.
- 조사는 공식 홈페이지 **Best**, 블로그(최신 날짜) **Not Bad**
</aside>

- ORM
    
    객체와 데이터베이스 테이블을 매핑해 SQL 없이 데이터 조작을 가능하게 하는 기술.
    객체지향 코드로 DB 접근을 단순화하며 생산성을 높인다.
    하지만 복잡한 쿼리에서는 성능 저하나 제약이 생길 수 있다.
    
- Prisma 문서 살펴보기
    - ex. Prisma의 Connection Pool 관리 방법
        
        Prisma는 직접 풀을 관리하지 않고 DB 드라이버의 Connection Pool을 사용한다.
        요청 시 기존 연결을 재사용해 효율적으로 DB를 접근한다.
        서버리스 환경에서는 Prisma 인스턴스를 전역으로 유지해야 한다.
        
    - ex. Prisma의 Migration 관리 방법
        
        prisma migrate 명령으로 스키마 변경을 추적하고 자동 반영한다.
        모든 스키마 변경 이력을 prisma/migrations 폴더에 저장한다.
        DB 구조 변경을 안전하고 일관되게 관리할 수 있다.
        
- ORM(Prisma)을 사용하여 좋은 점과 나쁜 점
    
    **장점:** 타입 안전성, 생산성 향상, 유지보수 용이.
    
    **단점:** 복잡한 SQL 표현의 제약, 추상화로 인한 디버깅 어려움.
    
    일반적인 CRUD엔 효율적이지만 대규모 쿼리엔 비효율적일 수 있다.
    
- 다양한 ORM 라이브러리 살펴보기
    
    **TypeORM, Sequelize**: Node.js 전통 ORM, 자유도 높음.
    
    **Hibernate, SQLAlchemy**: 대형 프로젝트나 Python 환경에 적합.
    
- 페이지네이션을 사용하는 다른 API 찾아보기
    - ex. https://docs.github.com/en/rest/using-the-rest-api/using-pagination-in-the-rest-api?apiVersion=2022-11-28
    - ex. https://developers.notion.com/reference/intro#pagination
    
    대량 데이터를 페이지 단위로 나누어 효율적으로 조회하는 방식.
    
    서버 부하를 줄이고 사용자 경험을 개선한다.
    
    대표 방식: **limit-offset**, **cursor 기반 페이지네이션**.
    

## 🧩 요약 정리

<aside>
💡

이번 주차 워크북을 정리해봅시다! 

이번 주차 워크북이 개념 중심이라면 개념을 정리하고, 실습 중심이라면 1개 이상의 실습 코드 분석 내용을 작성해주세요. (🎯 핵심 키워드에서 이미 정리한 내용은 제외해주셔도 괜찮습니다.)

</aside>

 

## ⚠️ 스터디 진행 방법

**1. 스터디 전 준비**

- 핵심 키워드와 미션을 모두 수행해 주세요.
- 워크북을 진행하면서 모르는 부분이나 질문하고 싶은 내용이 있다면 정리해 주세요.

**2. 스터디 시간**

- 서로 질문하고 답변해 주세요.
    - 워크북을 진행하면서 몰랐던 부분이나 미션 피드백을 통해 생긴 질문을 공유하고 답변해 주세요.
- 핵심 키워드와 미션을 공유해 주세요.
    - 각자가 정리한 핵심 키워드와 미션을 서로 공유해 주세요.
    - 파트장(또는 스터디장)은 파트원들의 수행 내용을 보고 피드백할 부분을 정리하여 전달해 주세요.
        - 스터디에 파트장이 없거나 인원이 부족한 경우, 이 과정은 생략할 수 있습니다.

**3. 스터디 후 회고**

- 스터디가 끝난 후, 배운 점과 새로 알게 된 점을 기록해 주세요.

<aside>
💌

스터디를 진행한 후에는 📮 [**스터디 피드백 구글 폼**](https://docs.google.com/forms/d/e/1FAIpQLSewNkp1eswtsPt50BKK_Gjsyi7KdPytgT24MysqNzAaroDBnw/viewform) 양식을 통해 스터디 피드백을 남겨주세요. 여러분의 솔직한 피드백으로 더 나은 워크북과 스터디를 만들어가고자 합니다. 많은 의견 부탁드립니다! 🙏

</aside>

## ✅ 실습 체크리스트

1. 실습 체크 리스트
- [x]  ORM 사용해보기
- [x]  DB 마이그레이션 파일 관리해보기
- [x]  목록 API 만들어보기

## ☑️ 실습 인증

<aside>
💡

웹 브라우저, IDE(VSCode 편집기) 및 터미널 이미지(스크린샷), 설명 등을 자유롭게 남겨주세요. 실습을 진행한 과정이 순차적으로 잘 드러나면 가장 좋습니다.

</aside>

> **GitHub 저장소 주소**
> 
> 
> https://github.com/… (자신의 GitHub 저장소 주소를 입력해주세요.)
> 

![스크린샷 2025-11-05 오후 1.38.00.png](Chapter%206%20ORM%20%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0%20(1)/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2025-11-05_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_1.38.00.png)

## ✨ 위클리 스크럼 과제

---

위클리 스크럼 과제는 OO주차 위클리 스크럼 아이스 브레이킹과 공통 질문을 모두 작성한 후, 아래에 질문을 복사 붙여넣기 한 다음 다같이 작성해주시면 됩니다. 

1. 비밀번호를 평문으로 DB에 저장하면 왜 위험할까요? 그리고 실제로 해싱을 구현할 때 어떤 단계(Controller /Service / Repository) 에서 처리하는게 맞을까요? (각자 본인 프로젝트에서는 어디에서 처리했는지도 함께 이야기해봐요!)  
    1. 평문 저장 시 DB가 유출되면 모든 계정이 즉시 노출되어 보안사고로 이어진다.
    2. 따라서 bcrypt 같은 해시 함수로 단방향 암호화를 적용해야 한다.
2. 3주차 API 설계서를 토대로 개발을 하면서 바뀐 점이 있나요? (응답 구조를 클라이언트가 보기 더 편하게 바꿨거나, URL이나 DTO를 수정했거나.. 등등) 
    1. user와 member을 혼용하는 경우가 있었는데 이번에 ORM을 사용하면서 user로 통일했다.
3. Postman이나 curl로 API를 테스트해보면서 가장 많이 겪은 에러는 무엇이었나요? 그리고 그 에러를 어떻게 해결했나요? 
    1. 데이터베이스에 해당 컬럼이 없다는 500번 에러가 나왔다.

## 🔥 미션

<aside>
📍 **주의 사항**

- 반드시 **중간 과정(인증 사진)**을 남기며 진행해주세요.
(API 구현 및 요청, 응답 테스트 스크린샷 등)
- GitHub 이슈를 먼저 생성하고, GitHub 이슈를 통해 **브랜치를 생성하여 진행**, push 해주세요.
</aside>

### 🍒 공통 미션

이번 주 미션으로는 Prisma ORM을 이용해서 아래의 API들을 구현해주세요. 4개의 API 가운데 반드시 3개 이상, 모든 조건을 구현해주셔야 합니다.

1. 기존에 구현했던 API의 Repository 함수들을 모두 Prisma ORM을 이용하도록 변경해주세요.
2. 내가 작성한 리뷰 목록
    - 참고 화면
        
        ![Untitled](Chapter%206%20ORM%20%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0%20(1)/9864d338-162d-42d6-9605-6f5ca4795c84.png)
        
3. 특정 가게의 미션 목록
4. 내가 진행 중인 미션 목록
5. 내가 진행 중인 미션을 진행 완료로 바꾸기
    - 참고 화면
        
        ![Untitled](Chapter%206%20ORM%20%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0%20(1)/Untitled.png)
        

미션을 수행한 후에는 사용하지 않는 `src/db.config.js` 파일 내의 내용들을 삭제해주시고, 아래 커맨드를 통해 사용하지 않는 패키지를 정리해주세요.

```jsx
npm uninstall mysql2
```

- 이후 본인의 깃허브 리포지토리를 만들어 `feature/chapter-06` 브랜치에 올린 후,
**해당 GitHub 링크를 본인 워크북에 포함해오기. (미션 기록란에 링크 제출)**
    
    **❗main 브랜치에 올리지 말 것!** (브랜치 명 꼭 `feature/chapter-06` 아니어도 됨!) **❗**
    
    **❗main 브랜치는 11주차의 `무중단 CI/CD (GitHub Actions + AWS EC2)` 에서 사용 할 예정❗**
    

### 🧙‍♂️ 시니어 미션

- 한 번에 여러 번의 DB 작업을 연달아 처리할 때, 중간에 처리가 실패했는데 DB에는 중간까지만 값이 반영되어 있으면 문제가 있을 것 같습니다. 이를 방지하는 기술로는 Transaction이 있는데, Prisma를 이용해 Transaction을 관리하는 방법을 찾아 정리해주세요. 워크북의 실습 프로젝트에서도 적용할 수 있다면 적용해주세요.
- DB 성능은 서버 개발에서 가장 중요한 부분 중 하나입니다. Prisma를 이용해서 데이터베이스에 질의할 때, 각 SQL 쿼리가 얼마나 오래 소요되는지 로그를 남겨주세요. (쿼리를 실행하기 전의 시간을 측정하고, 쿼리를 실행한 이후의 시간을 측정하여 몇 ms가 소요되었는지 측정하여 `console.log`로 출력할 수 있습니다.) 가능하면 쿼리를 사용하는 부분마다 매번 `console.log`로 출력하기 보다는, 항상 공통으로 자동으로 적용될 수 있는 방법으로 구현해주세요.
- 우리는 흔히 DB 쿼리에서 N+1 문제를 마주할 수 있습니다. 예를 들어, 게시글을 조회하면서 각 게시글에 해당하는 댓글들을 개별적으로 쿼리한다면, 댓글을 조회하는 쿼리가 각 게시글마다 추가로 발생하게 되어 N+1 문제가 발생합니다. 이를 Prisma에서 N+1문제를 해결할 수 있는 방법을 정리해주세요.

시니어 미션 체크리스트

- [ ]  Transaction 관리하는 방법 찾아 정리하기
- [ ]  Transaction을 내 프로젝트에 적용하기(선택)
- [ ]  SQL 쿼리 소요 로그 남기기
- [ ]  Prisma에서 N+1 문제를 해결할 수 있는 방법 정리하기

## 💪 미션 기록

<aside>
🍀 미션 기록의 경우, 아래 미션 기록 토글 속에 작성하시거나, 페이지를 새로 생성하여 해당 페이지에 기록하여도 좋습니다!

하지만, 결과물만 올리는 것이 아닌, **중간 과정 모두 기록하셔야 한다는 점!** 잊지 말아주세요.

</aside>

- 미션 기록
    
    [[ch06] 박태경 미션기록](Chapter%206%20ORM%20%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0%20(1)/%5Bch06%5D%20%EB%B0%95%ED%83%9C%EA%B2%BD%20%EB%AF%B8%EC%85%98%EA%B8%B0%EB%A1%9D%202a2b57f4596b80eaa378ccee09d9840a.md)
    

## ⚡ 트러블 슈팅

<aside>
💡 실습하면서 생긴 문제들에 대해서, **이슈 - 문제 - 해결** 순서로 작성해주세요.

스스로 해결하기 어렵다면? 스터디원들에게 도움을 요청하거나 **너디너리의 지식IN 채널**에 질문해보세요!

</aside>

- ⚡ 이슈 작성 예시 (이슈가 생기면 아래 버튼을 클릭해 No. 1, No. 2, No. 3, … 으로 작성해서 트러블 슈팅을 꼭 해보세요!)
    
    **`이슈`**
    
    👉 앱 실행 중에 노래 다음 버튼을 누르니까 앱이 종료되었다.
    
    **`문제`**
    
    👉 노래클래스의 데이터리스트의 Size를 넘어서 NullPointException이 발생하여 앱이 종료된 것이었다. 
    
    **`해결`**
    
    👉  노래 다음 버튼을 눌렀을 때 데이터리스트의 Size를 검사해 Size보다 넘어가려고 하면 다음으로 넘어가는 메서드를 실행시키지 않고, 첫 노래로 돌아가게끔 해결
    
    **`참고 레퍼런스`**
    
    - 링크

## 🤔 참고 자료

[참고 자료 목록 (1)](Chapter%206%20ORM%20%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0%20(1)/%EC%B0%B8%EA%B3%A0%20%EC%9E%90%EB%A3%8C%20%EB%AA%A9%EB%A1%9D%20(1)%2029db57f4596b811ea682d26db31ff3c6.csv)

---

Copyright © 2024~2025 김수빈(엘빈), 최재영(제리) All rights reserved.

Copyright © 2025 전하경(재서) All rights reserved.